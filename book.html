<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Detail knihy</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <link href="css/stylesheet.css" rel="stylesheet">

</head>
<body>
<div id="reading-progress"></div>

<div class="container py-5">

  <div class="text-center mb-4"><img src="images/albatrosmedia_logo.svg" class="book-img" alt="Book 4"></div>

  <!-- Book header -->
  <div class="text-center mb-4">

    <!-- Book Cover or Placeholder -->
    <img src="" id="bookCover" class="book-cover mb-3" alt="Book Cover">

    <div id="coverPlaceholder" class="cover-placeholder">
      <i class="bi bi-book"></i>
    </div>

    <h1></h1>
    <h5 class="text-muted"></h5>
  </div>

  <!-- Chapter content -->
  <div id="content" class="chapter-content"></div>

</div>

<!-- Bottom toolbar -->
<div id="bottom-toolbar">
  <button id="homeBtn" class="icon-btn"><i class="bi bi-house"></i></button>
  <button id="zoomOutBtn" class="icon-btn"><i class="bi bi-dash-circle"></i></button>
  <button id="zoomInBtn" class="icon-btn"><i class="bi bi-plus-circle"></i></button>
  <button id="themeBtn" class="icon-btn"><i class="bi bi-moon"></i></button>
  <button id="buyBtn" class="icon-btn"><i class="bi bi-cart2"></i></button>

  <!-- CTA tlačidlo pri dočítaní -->
  <a id="buyFullBtn" class="btn btn-primary" target="_blank">
    <i class="bi bi-cart2"></i>&nbsp;Kúpiť knihu
  </a>
</div>

<!-- Footer -->
<footer class="sticky-footer">
  2026 © Albatros Media Slovakia s.r.o.
</footer>


<script>
async function loadBook() {
  const params = new URLSearchParams(window.location.search);
  const id = params.get("id");

  const content = document.getElementById("content");
  const coverImg = document.getElementById("bookCover");
  const coverPlaceholder = document.getElementById("coverPlaceholder");

  if (!id) {
    content.textContent = "Kniha nebola nájdená.";
    coverImg.style.display = "none";
    coverPlaceholder.style.display = "flex";
    return;
  }

  const response = await fetch("books.json");
  const books = await response.json();
  const book = books[id];

  if (!book) {
    document.querySelector("h1").textContent = "Kniha neexistuje.";
    document.querySelector(".text-muted").textContent = "";
    content.innerHTML = "";
    coverImg.style.display = "none";
    coverPlaceholder.style.display = "flex";
    return;
  }

  if (book.public !== "1") {
    content.innerHTML = `
      <div class="alert alert-warning text-center">
        Tento titul ešte nie je dostupný na zobrazenie.
      </div>`;
    coverImg.style.display = "none";
    coverPlaceholder.style.display = "flex";
    return;
  }

  // Titulky
  document.querySelector("h1").textContent = book.title;
  document.querySelector(".text-muted").textContent = book.author;

  document.title = book.title;

  // Cover or placeholder
  if (book.cover && book.cover.trim() !== "") {
    coverImg.src = book.cover;
    coverImg.style.display = "block";
    coverPlaceholder.style.display = "none";
  } else {
    coverImg.style.display = "none";
    coverPlaceholder.style.display = "flex";
  }

  // Kapitola
  const chapterHTML = await fetch(book.chapter).then(r => r.text());
  content.innerHTML = chapterHTML;

  // Toolbar buy
  const buyToolbarBtn = document.getElementById("buyBtn");
  if (buyToolbarBtn) {
    buyToolbarBtn.onclick = () => window.open(book.buy, "_blank");
  }

  // CTA buy
  const buyFullBtn = document.getElementById("buyFullBtn");
  if (buyFullBtn) {
    buyFullBtn.onclick = () => window.open(book.buy, "_blank");
  }
}

loadBook();


// Scroll logika – prepínanie CTA a ikon
window.addEventListener("scroll", () => {
  const btnZoomOut = document.getElementById("zoomOutBtn");
  const btnZoomIn = document.getElementById("zoomInBtn");
  const btnTheme = document.getElementById("themeBtn");
  const btnBuy = document.getElementById("buyBtn");
  const btnFullBuy = document.getElementById("buyFullBtn");

  const scrollPos = window.scrollY + window.innerHeight;
  const bottom = document.body.offsetHeight;

  if (scrollPos >= bottom - window.innerHeight * 0.15) {

    btnZoomOut.style.display = "none";
    btnZoomIn.style.display = "none";
    btnTheme.style.display = "none";
    btnBuy.style.display = "none";

    btnFullBuy.style.display = "flex";

  } else {

    btnZoomOut.style.display = "flex";
    btnZoomIn.style.display = "flex";
    btnTheme.style.display = "flex";
    btnBuy.style.display = "flex";

    btnFullBuy.style.display = "none";
  }
});


// Zoom plus/mínus
document.getElementById("zoomInBtn").onclick = () => {
  const content = document.getElementById("content");
  const style = window.getComputedStyle(content).fontSize;
  const currentSize = parseFloat(style);
  content.style.fontSize = (currentSize + 2) + 'px';
};

document.getElementById("zoomOutBtn").onclick = () => {
  const content = document.getElementById("content");
  const style = window.getComputedStyle(content).fontSize;
  const currentSize = parseFloat(style);
  content.style.fontSize = (currentSize - 2) + 'px';
};


// DARK / LIGHT MODE PREPINAC
document.getElementById("themeBtn").onclick = () => {
  document.body.classList.toggle("dark-mode");

  const icon = document.querySelector("#themeBtn i");
  if (document.body.classList.contains("dark-mode")) {
    icon.classList.remove("bi-moon");
    icon.classList.add("bi-brightness-high");
  } else {
    icon.classList.remove("bi-brightness-high");
    icon.classList.add("bi-moon");
  }
};

window.addEventListener("scroll", () => {

  // Progress bar
  const scrollTop = window.scrollY;
  const docHeight = document.documentElement.scrollHeight - window.innerHeight;
  const progress = (scrollTop / docHeight) * 100;
  document.getElementById("reading-progress").style.width = progress + "%";

  const btnZoomOut = document.getElementById("zoomOutBtn");
  const btnZoomIn = document.getElementById("zoomInBtn");
  const btnTheme = document.getElementById("themeBtn");
  const btnBuy = document.getElementById("buyBtn");
  const btnFullBuy = document.getElementById("buyFullBtn");

  const scrollPos = window.scrollY + window.innerHeight;
  const bottom = document.body.offsetHeight;

  if (scrollPos >= bottom - window.innerHeight * 0.15) {

    btnZoomOut.style.display = "none";
    btnZoomIn.style.display = "none";
    btnTheme.style.display = "none";
    btnBuy.style.display = "none";

    btnFullBuy.style.display = "flex";

  } else {

    btnZoomOut.style.display = "flex";
    btnZoomIn.style.display = "flex";
    btnTheme.style.display = "flex";
    btnBuy.style.display = "flex";

    btnFullBuy.style.display = "none";
  }
});

</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
